<%- include('../partials/header') %>
<main class="recipe-detail-page">
    <div class="recipe-detail-container">
        <div class="recipe-header">
            <div class="recipe-header-content">
                <h1><%= recipe.title %></h1>
                <% if (recipe.description) { %>
                    <p class="recipe-description"><%= recipe.description %></p>
                <% } %>
            </div>
            
            <% if (isOwner) { %>
                <div class="recipe-actions">
                    <a href="/recipes/<%= recipe.recipe_id %>/edit" class="btn btn-secondary">Edit Recipe</a>
                    <form action="/recipes/<%= recipe.recipe_id %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this recipe? This action cannot be undone.');">
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            <% } %>
        </div>
        
        <% if (recipe.image_url) { %>
            <div class="recipe-image">
                <img src="<%= recipe.image_url %>" alt="<%= recipe.title %>">
            </div>
        <% } %>
        
        <div class="recipe-meta-info">
            <% if (recipe.prep_time) { %>
                <div class="meta-item">
                    <strong>Prep Time:</strong> <%= recipe.prep_time %> minutes
                </div>
            <% } %>
            <% if (recipe.cook_time) { %>
                <div class="meta-item">
                    <strong>Cook Time:</strong> <%= recipe.cook_time %> minutes
                </div>
            <% } %>
            <% if (recipe.prep_time && recipe.cook_time) { %>
                <div class="meta-item">
                    <strong>Total Time:</strong> <%= recipe.prep_time + recipe.cook_time %> minutes
                </div>
            <% } %>
            <% if (recipe.servings) { %>
                <div class="meta-item">
                    <strong>Servings:</strong> <%= recipe.servings %>
                </div>
            <% } %>
            <% if (recipe.difficulty) { %>
                <div class="meta-item">
                    <strong>Difficulty:</strong> <span class="difficulty-badge <%= recipe.difficulty %>"><%= recipe.difficulty.charAt(0).toUpperCase() + recipe.difficulty.slice(1) %></span>
                </div>
            <% } %>
        </div>
        
        <% if (recipe.original_recipe_id) { %>
            <div class="recipe-origin">
                <p>ðŸ“‹ This recipe was copied from another recipe (ID: <%= recipe.original_recipe_id %>)</p>
            </div>
        <% } %>
        
        <div class="recipe-content-grid">
            <section class="ingredients-section">
                <h2>Ingredients</h2>
                <% if (recipe.ingredients && recipe.ingredients.length > 0) { %>
                    <ul class="ingredients-list">
                        <% recipe.ingredients.forEach(ingredient => { %>
                            <li>
                                <span class="ingredient-quantity"><%= ingredient.quantity %></span>
                                <span class="ingredient-name"><%= ingredient.ingredient_name %></span>
                            </li>
                        <% }); %>
                    </ul>
                <% } else { %>
                    <p class="no-ingredients">No ingredients listed.</p>
                <% } %>
            </section>
            
            <section class="instructions-section">
                <h2>Instructions</h2>
                <div class="instructions-content">
                    <%= recipe.instructions.replace(/\n/g, '<br>') %>
                </div>
            </section>
        </div>
        
        <div class="recipe-footer">
            <p class="recipe-author">Created by <%= recipe.first_name %> <%= recipe.last_name %></p>
            <p class="recipe-date">Added on <%= new Date(recipe.created_at).toLocaleDateString() %></p>
            <% if (recipe.updated_at && recipe.updated_at !== recipe.created_at) { %>
                <p class="recipe-date">Last updated on <%= new Date(recipe.updated_at).toLocaleDateString() %></p>
            <% } %>
        </div>
        
        <div class="navigation-links">
            <a href="/recipes">&larr; Back to My Recipes</a>
        </div>
    </div>
</main>

<style>
.btn-danger {
    background-color: #f44336;
    color: white;
}
.btn-danger:hover {
    background-color: #da190b;
}
</style>

<%- include('../partials/footer') %>